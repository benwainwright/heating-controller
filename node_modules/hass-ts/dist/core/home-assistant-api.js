"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.HomeAssistantApi = void 0;
const homeassistant_ws_1 = __importDefault(require("homeassistant-ws"));
const isomorphic_ws_1 = __importDefault(require("isomorphic-ws"));
class HomeAssistantApi {
    constructor(hassConfig) {
        this.hassConfig = hassConfig;
    }
    get get() {
        if (!this.hassApi) {
            throw new Error("Hass API has not been initialised. Please call .init()");
        }
        return this.hassApi;
    }
    close() {
        this.hassApi = undefined;
    }
    async init() {
        if (!this.hassApi) {
            const ws = !this.hassConfig.port
                ? {
                    ws: (opts) => {
                        return new isomorphic_ws_1.default(`${opts.protocol}://${opts.host}${opts.path}`);
                    },
                }
                : {};
            this.hassApi = await (0, homeassistant_ws_1.default)({
                host: this.hassConfig.host,
                token: this.hassConfig.token,
                port: this.hassConfig.port,
                path: this.hassConfig.path,
                ...ws,
            });
        }
    }
}
exports.HomeAssistantApi = HomeAssistantApi;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaG9tZS1hc3Npc3RhbnQtYXBpLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2NvcmUvaG9tZS1hc3Npc3RhbnQtYXBpLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLHdFQUFnRTtBQUNoRSxrRUFBc0M7QUFHdEMsTUFBYSxnQkFBZ0I7SUFHM0IsWUFBMkIsVUFBc0I7UUFBdEIsZUFBVSxHQUFWLFVBQVUsQ0FBWTtJQUFHLENBQUM7SUFFckQsSUFBVyxHQUFHO1FBQ1osSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDakIsTUFBTSxJQUFJLEtBQUssQ0FBQyx3REFBd0QsQ0FBQyxDQUFDO1NBQzNFO1FBRUQsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDO0lBQ3RCLENBQUM7SUFFTSxLQUFLO1FBQ1YsSUFBSSxDQUFDLE9BQU8sR0FBRyxTQUFTLENBQUM7SUFDM0IsQ0FBQztJQUVNLEtBQUssQ0FBQyxJQUFJO1FBQ2YsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDakIsTUFBTSxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUk7Z0JBQzlCLENBQUMsQ0FBQztvQkFDRSxFQUFFLEVBQUUsQ0FBQyxJQUFtQixFQUFFLEVBQUU7d0JBQzFCLE9BQU8sSUFBSSx1QkFBUyxDQUNsQixHQUFHLElBQUksQ0FBQyxRQUFRLE1BQU0sSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQzlDLENBQUM7b0JBQ0osQ0FBQztpQkFDRjtnQkFDSCxDQUFDLENBQUMsRUFBRSxDQUFDO1lBRVAsSUFBSSxDQUFDLE9BQU8sR0FBRyxNQUFNLElBQUEsMEJBQUksRUFBQztnQkFDeEIsSUFBSSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSTtnQkFDMUIsS0FBSyxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSztnQkFDNUIsSUFBSSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSTtnQkFDMUIsSUFBSSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSTtnQkFDMUIsR0FBRyxFQUFFO2FBQ04sQ0FBQyxDQUFDO1NBQ0o7SUFDSCxDQUFDO0NBQ0Y7QUF0Q0QsNENBc0NDIn0=